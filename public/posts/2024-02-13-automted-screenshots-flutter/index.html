<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Automated screenshots in Flutter (without pain) | /home/dudozer_maks/</title>

    <link rel="stylesheet" href="/css/main.css">


      <script src="/js/main.js"></script>


</head>
<body>
	<div id="centering">
		<header>
			<h1>/home/dudozer_maks/</h1>

  <nav>
    <ul>
    <li>
      <a href="/">Home</a>
    </li>
    <li>
      <a aria-current="true" class="ancestor" href="/posts/">Posts</a>
    </li>
    <li>
      <a href="/tags/">Tags</a>
    </li>
    </ul>
  </nav>


		</header>
		<main>
			
  <h1>Automated screenshots in Flutter (without pain)</h1>

  
  
  <time datetime="2024-02-13T09:00:00-07:00">February 13, 2024</time>

  <h1 id="generating-screenshots-in-flutter">Generating screenshots in Flutter.</h1>
<!-- raw HTML omitted -->
<ul>
<li><a href="#generating-screenshots-in-flutter">Generating screenshots in Flutter.</a>
<ul>
<li><a href="#pre-made-libraries-and-other-ways">Pre-made libraries and other ways</a></li>
<li><a href="#my-solution">My solution</a>
<ul>
<li><a href="#step-1-adding-dependencies">Step 1. Adding dependencies</a></li>
<li><a href="#step-2-create-test-file">Step 2. Create test file</a></li>
<li><a href="#step-3-write-tests">Step 3. Write tests</a></li>
</ul>
</li>
<li><a href="#ending">Ending</a></li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<h2 id="pre-made-libraries-and-other-ways">Pre-made libraries and other ways</h2>
<p>I&rsquo;m building my app with Flutter called
<a href="https://github.com/dudozermaks/sudoku">sudoku</a>. Just before the first release I
found out that I have no screenshots for my app. I had two options to make
them:</p>
<ol>
<li>By hand</li>
<li>Automate that task</li>
</ol>
<p>My app grows quickly and interface changes fast, which means that screenshotting by hand is
dumb idea. So I started looking into how I can implement automated screenshots.
I, again, have many options:</p>
<ol>
<li>This
<a href="https://medium.com/@mregnauld/generate-screenshots-for-a-flutter-app-with-golden-testing-and-upload-them-to-the-stores-1-2-45f8df777aef">article</a>.
It is very complex in my opinion, and, I need simple plain screenshots
without any text on them. Plus there is no source code available.</li>
<li><code>auto_screenshot</code> library, which is working only if app uses deep-linking
(<a href="https://pub.dev/packages/auto_screenshot">link</a>)</li>
<li><code>screenshots</code> library, which is Dart 3 incompatible (<a href="https://pub.dev/packages/screenshots">link</a>)</li>
<li>&hellip; and many more I forgot to list here</li>
</ol>
<p>As you can see, I did not quite like any of these approaches. So, I tried to
create my own.</p>
<h2 id="my-solution">My solution</h2>
<p>My solution uses only <code>flutter_test</code> and <code>integration_test</code>. That&rsquo;s all! Here is
a <a href="https://github.com/dudozermaks/flutter_automated_screenshots_showcase">repo</a> where you can find everything mentioned in this
guide.</p>
<h3 id="step-1-adding-dependencies">Step 1. Adding dependencies</h3>
<p>Go to your project and open <code>pubspec.yaml</code>. Find a line that says
<code>dev_dependencies</code>. Add this lines underneath it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">dev_dependencies</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">flutter_test</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sdk</span>: <span style="color:#ae81ff">flutter</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">integration_test</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sdk</span>: <span style="color:#ae81ff">flutter</span>
</span></span></code></pre></div><p>Run <code>flutter pub get</code></p>
<h3 id="step-2-create-test-file">Step 2. Create test file</h3>
<p>Inside your project, create a folder called <code>integration_test</code>. Inside it, create
file named as you wish, but with <code>_test.dart</code> on the end. Mine is named
<code>screenshots_test.dart</code>. Inside this file, insert following lines:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;package:flutter_test/flutter_test.dart&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;package:integration_test/integration_test.dart&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> main() {
</span></span><span style="display:flex;"><span>  IntegrationTestWidgetsFlutterBinding.ensureInitialized();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// If you have something async to setup, before running your app,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// do it in this function
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  setUpAll(() <span style="color:#66d9ef">async</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Right here.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="step-3-write-tests">Step 3. Write tests</h3>
<p>At this step, our actions might be different, depending on your app. But I will
show you, how to do screenshots with standard app, which <code>flutter create somename</code> produces.</p>
<p>I have this function, called <code>makeScreenshot</code>, here is what it does:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> makeScreenshot(
</span></span><span style="display:flex;"><span>    Widget w, <span style="color:#66d9ef">String</span> testName, <span style="color:#66d9ef">String</span> fileName, Function(WidgetTester) actions) {
</span></span><span style="display:flex;"><span>  testWidgets(testName, (WidgetTester tester) <span style="color:#66d9ef">async</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Change size of screen
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    tester.view.physicalSize <span style="color:#f92672">=</span> <span style="color:#66d9ef">const</span> Size(<span style="color:#ae81ff">1080</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1920</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Make flutter to simulate Android platform
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// This is done in order to get more Android-looking screenshots
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    debugDefaultTargetPlatformOverride <span style="color:#f92672">=</span> TargetPlatform.android;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Adding widget to the test
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">await</span> tester.pumpWidget(w);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Waiting a little, so that flutter renders it
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// Might be unnecessary in your case
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">await</span> tester.pumpAndSettle(<span style="color:#66d9ef">const</span> Duration(milliseconds: <span style="color:#ae81ff">100</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> actions(tester);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// The golden test: Finding our app in the test by type, and
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// comparing it with previous screenshot
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">await</span> expectLater(
</span></span><span style="display:flex;"><span>      find.byType(MyApp),
</span></span><span style="display:flex;"><span>      matchesGoldenFile(<span style="color:#e6db74">&#39;screenshots/</span><span style="color:#e6db74">$</span>fileName<span style="color:#e6db74">.png&#39;</span>),
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// To prevent an error, setting this to null
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    debugDefaultTargetPlatformOverride <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>With this function I can create some nice-looking screenshots of my default app.
At the end of <code>main</code> function I inserted this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>makeScreenshot(
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> MyApp(),
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Default page&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;default_page&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// No need to do anything in test, simple home page screenshot
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  (tester) <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>Then I run <code>flutter test integration_test --update-goldens</code>. And there I have
it! Screenshot of default page located at
<code>integration_test/screenshots/default_page.png</code>.</p>
<p><img src="https://raw.githubusercontent.com/dudozermaks/flutter_automated_screenshots_showcase/main/integration_test/screenshots/default_page.png" alt="First screenshot"></p>
<p>&ldquo;But that&rsquo;s boring&rdquo;, you might say, &ldquo;What if I need to click on some buttons or do something else
before screenshot is taken?&rdquo; I got you, that is easy too! Let&rsquo;s say that we have
a button with <code>add</code> icon on this page, and we want to tap on it. Just add
another <code>makeScreenshot</code> call below the first one and modify it a bit.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span>makeScreenshot(
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> MyApp(),
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Incremented page&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;incremented_page&#34;</span>,
</span></span><span style="display:flex;"><span>  (tester) <span style="color:#66d9ef">async</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// finding button by Icon and tapping on it
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">await</span> tester.tap(find.byIcon(Icons.add));
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// waiting a little bit
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">await</span> tester.pumpAndSettle();
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p><code>find</code> and <code>tester</code> have other useful methods. You can find them in the
documentation, both for
<a href="https://api.flutter.dev/flutter/flutter_test/CommonFinders-class.html">find</a>
and <a href="https://api.flutter.dev/flutter/flutter_test/WidgetTester-class.html">tester</a></p>
<p>Run <code>flutter test integration_test --update-goldens</code> again, and there you have
it, another screenshot.</p>
<p><img src="https://raw.githubusercontent.com/dudozermaks/flutter_automated_screenshots_showcase/main/integration_test/screenshots/incremented_page.png" alt="Second
screenshot"></p>
<h2 id="ending">Ending</h2>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>That&rsquo;s it for now! Again, you can find everything I did here in this GitHub
<a href="https://github.com/dudozermaks/flutter_automated_screenshots_showcase">repo</a>. Also, here is an
<a href="https://github.com/dudozermaks/sudoku/blob/8a6713e614dd1e51ef4b12a5d6440cae54ce2c01/integration_test/screenshots_test.dart">example</a> of how I do it in my
project</p>

  
  <div>
    <div>Tags:</div>
    <ul>
        <li><a href="/tags/flutter/">Flutter</a></li>
        <li><a href="/tags/screenshots/">Screenshots</a></li>
    </ul>
  </div>


		</main>
		<center>
			<footer>
				<p>Â© dudozer_maks 2024. All rights reserved.</p>

			</footer>
		</center>
	</div>
</body>
</html>
